{"dependencies":[{"name":"https://unpkg.com/mitt@1.1.2/dist/mitt.es.js","loc":{"line":1,"column":17}}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.subscribe = exports.connect = undefined;\n\nvar _mittEs = require(\"https://unpkg.com/mitt@1.1.2/dist/mitt.es.js\");\n\nvar _mittEs2 = _interopRequireDefault(_mittEs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nlet globalId = 0;\nlet spec = 'lib-tag';\n\nlet emitterProto = Object.create(null);\nemitterProto.post = function (type, data) {\n  this._worker.postMessage({\n    spec: spec,\n    type: type,\n    id: this._id,\n    data: data\n  });\n};\nemitterProto.addEventListener = function (type, cb) {\n  this._emitter.on(type, cb);\n};\nemitterProto.removeEventListener = function (type, cb) {\n  this._emitter.off(type, cb);\n};\nemitterProto.emit = function (a, b) {\n  this._emitter.emit(a, b);\n};\nemitterProto.handleEvent = function (ev) {\n  let msg = ev.data || {};\n  if (msg.spec === spec && msg.id === this._id) {\n    this.emit(msg.type, msg.data);\n  }\n};\n\nfunction createEmitter(tag, worker, id) {\n  let e = Object.create(emitterProto);\n  e._tag = tag;\n  if (id === undefined) {\n    id = globalId = globalId + 1;\n  }\n  e._id = id;\n  e._worker = worker;\n  e._emitter = (0, _mittEs2.default)();\n  return e;\n}\n\nfunction connect(tag, worker) {\n  let e = createEmitter(tag, worker);\n  worker.addEventListener('message', e);\n  return e;\n}\n\nfunction subscribe(tag, cb) {\n  let idMap = new Map();\n\n  self.addEventListener('message', function (ev) {\n    let msg = ev.data || {};\n    if (msg.spec === spec) {\n      let emitter = idMap.get(msg.id);\n      if (!emitter) {\n        emitter = createEmitter(tag, self, msg.id);\n        cb(emitter);\n        idMap.set(msg.id, emitter);\n      }\n      emitter.emit(msg.type, msg.data);\n    }\n  });\n}\n\nexports.connect = connect;\nexports.subscribe = subscribe;"},"hash":"1c4676fc4efd038895b2139b38537a3f"}